<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document List</title>
    <link rel="stylesheet" href="/assert/css/font-awesome.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #1a73e8;
            margin-bottom: 30px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 25px;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }

        .navigation {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .back-button {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .back-button:hover {
            background-color: #1557b0;
        }

        .back-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .current-path {
            color: #666;
            font-size: 14px;
            flex-grow: 1;
        }

        .list {
            list-style-type: none;
            padding: 0;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin: 8px 0;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .list-item:hover {
            background-color: #f8f9fa;
        }

        .list-item a {
            text-decoration: none;
            color: #1a73e8;
            flex-grow: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .list-item a:hover {
            color: #1557b0;
        }

        .file-size {
            margin-right: 20px;
            color: #666;
            font-size: 14px;
        }

        .delete-button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .delete-button:hover {
            background-color: #c82333;
        }

        .empty-message {
            text-align: center;
            color: #666;
            padding: 20px;
            font-style: italic;
        }

        .search-container {
            display: flex;
            align-items: center;
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 4px 12px;
            border: 1px solid #e0e0e0;
            flex-grow: 1;
            max-width: 400px;
        }

        .search-container i {
            color: #666;
            margin-right: 8px;
        }

        .search-input {
            border: none;
            background: none;
            outline: none;
            padding: 6px 0;
            width: 100%;
            font-size: 14px;
            color: #333;
        }

        .search-input::placeholder {
            color: #999;
        }

        .no-results {
            text-align: center;
            color: #666;
            padding: 20px;
            font-style: italic;
            display: none;
        }
    </style>
    <script>
        function deleteFile(endpoint, fileName) {
            const filePath = endpoint + '/' + fileName;
            if (confirm("Are you sure you want to delete " + fileName + "?")) {
                fetch(filePath, {method: 'DELETE'})
                    .then(response => {
                        if (response.ok) {
                            location.reload();
                        } else {
                            alert("Failed to delete file.");
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        alert("Failed to delete file.");
                    });
            }
        }

        function formatSize(size) {
            if (size < 1024) return size + ' B';
            let units = ['KB', 'MB', 'GB', 'TB'];
            let unitIndex = -1;
            do {
                size = size / 1024;
                unitIndex++;
            } while (size >= 1024 && unitIndex < units.length - 1);
            return size.toFixed(1) + ' ' + units[unitIndex];
        }

        function getParentPath() {
            const path = window.location.pathname;
            const cleanPath = path.endsWith('/') ? path.slice(0, -1) : path;
            const lastSlashIndex = cleanPath.lastIndexOf('/');
            if (lastSlashIndex <= 0) return '';
            return cleanPath.substring(0, lastSlashIndex);
        }

        function filterFiles(searchTerm) {
            const listItems = document.querySelectorAll('.list-item');
            const noResults = document.querySelector('.no-results');
            let hasVisibleItems = false;

            searchTerm = searchTerm.toLowerCase();

            listItems.forEach(item => {
                const fileName = item.querySelector('a').textContent.toLowerCase();
                if (fileName.includes(searchTerm)) {
                    item.style.display = '';
                    hasVisibleItems = true;
                } else {
                    item.style.display = 'none';
                }
            });

            // 显示或隐藏"无结果"消息
            if (!hasVisibleItems && searchTerm !== '') {
                noResults.style.display = 'block';
            } else {
                noResults.style.display = 'none';
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            // Format file sizes
            let sizeElements = document.querySelectorAll(".file-size");
            sizeElements.forEach(function (element) {
                let size = parseInt(element.getAttribute("data-size"), 10);
                element.textContent = formatSize(size);
            });

            // Setup back button
            const backButton = document.getElementById('backButton');
            const parentPath = getParentPath();
            if (parentPath === '') {
                backButton.disabled = true;
            } else {
                backButton.onclick = function() {
                    window.location.href = parentPath;
                };
            }

            // Display current path
            const currentPath = document.getElementById('currentPath');
            const path = window.location.pathname;
            const cleanPath = path.endsWith('/') ? path.slice(0, -1) : path;
            currentPath.textContent = cleanPath || '/';

            // 设置搜索功能
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function(e) {
                filterFiles(e.target.value);
            });
        });
    </script>
</head>
<body>
<div class="container">
    <h1><i class="fas fa-folder-open"></i> Document List</h1>
    <div class="navigation">
        <button id="backButton" class="back-button">
            <i class="fas fa-arrow-left"></i> Back
        </button>
        <div id="currentPath" class="current-path"></div>
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" class="search-input" placeholder="搜索文件...">
        </div>
    </div>
    <div class="files">
        <ul class="list">
            {{range .Files}}
            <li class="list-item">
                <a href="{{if .IsDir}}{{$.DownloadEndpoint}}/{{.Name}}{{else}}{{$.DownloadEndpoint}}/{{.Name}}{{end}}">
                    <i class="{{if .IsDir}}fas fa-folder{{else}}fas fa-file{{end}}"></i>
                    {{.Name}}
                </a>
                {{if not .IsDir}}
                <span class="file-size" data-size="{{.Size}}"></span>
                <button class="delete-button" onclick="deleteFile('{{$.DeleteEndpoint}}','{{.Name}}')">
                    <i class="fas fa-trash"></i>
                    Delete
                </button>
                {{end}}
            </li>
            {{else}}
            <li class="empty-message">No files or directories available</li>
            {{end}}
        </ul>
        <div class="no-results">没有找到匹配的文件</div>
    </div>
</div>
</body>
</html>
